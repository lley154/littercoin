lawrence@lawrence-MacBookAir:~/src/littercoin/scripts/cardano-cli$ ./mint-littercoin.sh preprod
+ '[' -z preprod ']'
+ ENV=preprod
+++ readlink -f ./mint-littercoin.sh
++ dirname /home/lawrence/src/littercoin/scripts/cardano-cli/mint-littercoin.sh
+ MY_DIR=/home/lawrence/src/littercoin/scripts/cardano-cli
+ source /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export BASE=/home/lawrence/src/littercoin
++ BASE=/home/lawrence/src/littercoin
++ export WORK=/home/lawrence/src/littercoin/work
++ WORK=/home/lawrence/src/littercoin/work
++ export CARDANO_CLI=/usr/local/bin/cardano-cli
++ CARDANO_CLI=/usr/local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/preprod/node.socket
++ export TESTNET_MAGIC=1
++ TESTNET_MAGIC=1
++ export ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/testnet/admin/key.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/testnet/admin/key.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/testnet/admin/key.pkh
++ export MERCHANT_SKEY=/home/lawrence/.local/keys/testnet/merchant/key.skey
++ MERCHANT_SKEY=/home/lawrence/.local/keys/testnet/merchant/key.skey
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export MIN_ADA_OUTPUT_TX_REF=20000000
++ MIN_ADA_OUTPUT_TX_REF=20000000
++ export COLLATERAL_ADA=11000000
++ COLLATERAL_ADA=11000000
++ export ADMIN_UTXO=46dbefe6698abc2aabe03c380d0c9096fb054e742583ef2d9c4f09c980fa831a#0
++ ADMIN_UTXO=46dbefe6698abc2aabe03c380d0c9096fb054e742583ef2d9c4f09c980fa831a#0
++ export ADMIN_COLLATERAL=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ ADMIN_COLLATERAL=b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0
++ export ADMIN_CHANGE_ADDR=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
++ ADMIN_CHANGE_ADDR=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
++ export MERCHANT_ADDR=addr_test1vq7k907l7e59t52skm8e0ezsnmmc7h4xy30kg2klwc5n8rqug2pds
++ MERCHANT_ADDR=addr_test1vq7k907l7e59t52skm8e0ezsnmmc7h4xy30kg2klwc5n8rqug2pds
++ export MERCHANT_UTXO_NFT_TOKEN=5b2fd4c1c21d00500f4b299c9d1eeeef7a8e0e22ea3f88b9e2128ca225d9d909#1
++ MERCHANT_UTXO_NFT_TOKEN=5b2fd4c1c21d00500f4b299c9d1eeeef7a8e0e22ea3f88b9e2128ca225d9d909#1
++ export MERCHANT_UTXO_LC_TOKEN=ee864c7522201d1b86c711c985acd7d5f19fdb9509aa63a4db0a98484584d213#1
++ MERCHANT_UTXO_LC_TOKEN=ee864c7522201d1b86c711c985acd7d5f19fdb9509aa63a4db0a98484584d213#1
++ export MERCHANT_UTXO=e70f8a3d2195d22d474bcc0775ac2d7f239cedebf708789ab266bc581c6eccd7#0
++ MERCHANT_UTXO=e70f8a3d2195d22d474bcc0775ac2d7f239cedebf708789ab266bc581c6eccd7#0
++ export MERCHANT_COLLATERAL=dbc3d08f752d876281c1c02c6813316f4bb39e15e3e4fd644799822b327686cb#1
++ MERCHANT_COLLATERAL=dbc3d08f752d876281c1c02c6813316f4bb39e15e3e4fd644799822b327686cb#1
++ export USER_ADDR=addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg
++ USER_ADDR=addr_test1vq5s7k4kwqz4rrfe8mm9jz9tpm7c5u93yfwwsaw708yxs5sm70qjg
++ export LC_VAL_REF_SCRIPT=57b2e140c3657afb6affa08886906020e67a11df582f45307e4596d71e48ece5#2
++ LC_VAL_REF_SCRIPT=57b2e140c3657afb6affa08886906020e67a11df582f45307e4596d71e48ece5#2
++ export LC_MINT_REF_SCRIPT=57b2e140c3657afb6affa08886906020e67a11df582f45307e4596d71e48ece5#3
++ LC_MINT_REF_SCRIPT=57b2e140c3657afb6affa08886906020e67a11df582f45307e4596d71e48ece5#3
++ export NFT_MINT_REF_SCRIPT=20a6c33162e21420d671f64a983023855fe2444cb0e8bb988718eb2d9d833aa4#4
++ NFT_MINT_REF_SCRIPT=20a6c33162e21420d671f64a983023855fe2444cb0e8bb988718eb2d9d833aa4#4
+ '[' preprod == mainnet ']'
+ network='--testnet-magic 1'
+ echo 'Socket path: /home/lawrence/preprod/node.socket'
Socket path: /home/lawrence/preprod/node.socket
+ ls -al /home/lawrence/preprod/node.socket
srw------- 1 lawrence lawrence 0 Dec  8 08:00 /home/lawrence/preprod/node.socket
+ mkdir -p /home/lawrence/src/littercoin/work
+ mkdir -p /home/lawrence/src/littercoin/work-backup
+ rm -f /home/lawrence/src/littercoin/work/cli-build.out /home/lawrence/src/littercoin/work/lc-datum-in.json /home/lawrence/src/littercoin/work/lc-datum-out.json /home/lawrence/src/littercoin/work/lc-validator-utxo.json /home/lawrence/src/littercoin/work/pparms.json /home/lawrence/src/littercoin/work/redeemer-mint-lc.json /home/lawrence/src/littercoin/work/redeemer-mint.json
+ rm -f '/home/lawrence/src/littercoin/work-backup/*'
+ /usr/local/bin/cardano-cli query protocol-parameters --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/pparms.json
++ cat /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/thread-token-minting-policy.hash
++ jq -r .bytes
+ thread_token_mph=3c71662cfdfeebbaa8363c63d94ddf336c557c6776b789b05c23c385
++ cat /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/thread-token-name.json
++ jq -r .bytes
+ thread_token_name=0897af6dbe66e80c578e66f1f32a0b38137289ad08dad3ed7eea0a95af64662f
+ lc_mint_script=/home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/lc-minting-policy.plutus
++ cat /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/lc-minting-policy.hash
++ jq -r .bytes
+ lc_mint_mph=e7a3473ad76c48a622c70c6da628b6dcb48e11a2117a3ab4c109e87a
++ cat /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/lc-token-name.json
++ jq -r .bytes
+ lc_token_name=4c6974746572636f696e
+ lc_validator_script=/home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/lc-validator.plutus
++ /usr/local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/lc-validator.plutus --testnet-magic 1
+ lc_validator_script_addr=addr_test1wz6q4g52lq2vznfuw5f7ersq0cmlh5jdd6ppvauzrcq5j2stgrpmj
+ redeemer_file_path=/home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/redeemer-mint.json
+ redeemer_lc_file_path=/home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/redeemer-mint-lc.json
+ token_metadata_file_path=/home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/lc-token-metadata.json
++ cat /home/lawrence/.local/keys/testnet/admin/key.pkh
+ admin_pkh=b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682
+ readarray rows
+ lc_amount=0
+ for row in "${rows[@]}"
+ row_array=(${row})
+ qty=25
+ lc_amount=25
+ '[' preprod == devnet ']'
+ admin_utxo_in=46dbefe6698abc2aabe03c380d0c9096fb054e742583ef2d9c4f09c980fa831a#0
+ admin_utxo_addr=addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7
+ /usr/local/bin/cardano-cli query utxo --address addr_test1wz6q4g52lq2vznfuw5f7ersq0cmlh5jdd6ppvauzrcq5j2stgrpmj --testnet-magic 1 --out-file /home/lawrence/src/littercoin/work/lc-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."3c71662cfdfeebbaa8363c63d94ddf336c557c6776b789b05c23c385"."0897af6dbe66e80c578e66f1f32a0b38137289ad08dad3ed7eea0a95af64662f") 
| .key' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_utxo_tx_in=46dbefe6698abc2aabe03c380d0c9096fb054e742583ef2d9c4f09c980fa831a#1
++ jq -r 'to_entries[] 
| select(.value.value."3c71662cfdfeebbaa8363c63d94ddf336c557c6776b789b05c23c385"."0897af6dbe66e80c578e66f1f32a0b38137289ad08dad3ed7eea0a95af64662f") 
| .value.inlineDatum' /home/lawrence/src/littercoin/work/lc-validator-utxo.json
+ lc_validator_datum_in='{
  "constructor": 0,
  "fields": [
    {
      "int": 10000000
    },
    {
      "int": 0
    }
  ]
}'
+ echo -n '{
  "constructor": 0,
  "fields": [
    {
      "int": 10000000
    },
    {
      "int": 0
    }
  ]
}'
++ jq -r '.fields[0].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_ada=10000000
++ jq -r '.fields[1].int' /home/lawrence/src/littercoin/work/lc-datum-in.json
+ total_lc=0
+ new_total_lc=25
+ cat /home/lawrence/src/littercoin/work/lc-datum-in.json
+ jq -c '
  .fields[1].int   |= 25'
+ cat /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/redeemer-mint.json
+ jq -c '
  .fields[0].int          |= 25'
+ cat /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/redeemer-mint-lc.json
+ jq -c '
  .fields[1].int          |= 10000000'
+ printf %s '/usr/local/bin/cardano-cli transaction build '
+ printf %s '--babbage-era '
+ printf %s '--cardano-mode '
+ printf %s '--testnet-magic 1 '
+ printf %s '--change-address addr_test1vzu6hnmgvageu2qyypy25yfqwg222tndt5eg3d6j68p8dqspgdxn7 '
+ printf %s '--tx-in-collateral b4e326f019a9fa98d97a87c03cb86434f215ad6f7a4e5cbce6e06c306ee780d2#0 '
+ printf %s '--tx-in 46dbefe6698abc2aabe03c380d0c9096fb054e742583ef2d9c4f09c980fa831a#0 '
+ printf %s '--tx-in 46dbefe6698abc2aabe03c380d0c9096fb054e742583ef2d9c4f09c980fa831a#1 '
+ printf %s '--spending-tx-in-reference 57b2e140c3657afb6affa08886906020e67a11df582f45307e4596d71e48ece5#2 '
+ printf %s '--spending-plutus-script-v2 '
+ printf %s '--spending-reference-tx-in-inline-datum-present '
+ printf %s '--spending-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-mint.json '
+ printf %s '--mint '\''25 e7a3473ad76c48a622c70c6da628b6dcb48e11a2117a3ab4c109e87a.4c6974746572636f696e'\'' '
+ printf %s '--mint-tx-in-reference 57b2e140c3657afb6affa08886906020e67a11df582f45307e4596d71e48ece5#3 '
+ printf %s '--mint-plutus-script-v2 '
+ printf %s '--mint-reference-tx-in-redeemer-file /home/lawrence/src/littercoin/work/redeemer-mint-lc.json '
+ printf %s '--policy-id e7a3473ad76c48a622c70c6da628b6dcb48e11a2117a3ab4c109e87a '
+ printf %s '--tx-out '\''addr_test1wz6q4g52lq2vznfuw5f7ersq0cmlh5jdd6ppvauzrcq5j2stgrpmj+10000000 + 1 3c71662cfdfeebbaa8363c63d94ddf336c557c6776b789b05c23c385.0897af6dbe66e80c578e66f1f32a0b38137289ad08dad3ed7eea0a95af64662f'\'' '
+ printf %s '--tx-out-inline-datum-file /home/lawrence/src/littercoin/work/lc-datum-out.json '
+ for row in "${rows[@]}"
+ printf %s '--tx-out '\''addr_test1qze9w9uvm0524psnam4hyrjscr9dznujt0p65p0mz7md94q76nzq682nke2r2znd4sw6xrxzs8qhdg5fwzs3tzm9c4vqawm0zl+2000000 + 25 e7a3473ad76c48a622c70c6da628b6dcb48e11a2117a3ab4c109e87a.4c6974746572636f696e'\'' '
+ tr -d '\n'
+ printf %s '--required-signer-hash b9abcf6867519e28042048aa11207214a52e6d5d3288b752d1c27682 '
+ printf %s '--protocol-params-file /home/lawrence/src/littercoin/work/pparms.json '
+ printf %s '--metadata-json-file /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/lc-token-metadata.json '
+ printf %s '--calculate-plutus-script-cost /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/mint-littercoin.costs '
+ bash /home/lawrence/src/littercoin/work/cli-build.out
Estimated transaction fee: Lovelace 468031
+ echo 'tx has been built'
tx has been built
lawrence@lawrence-MacBookAir:~/src/littercoin/scripts/cardano-cli$ more /home/lawrence/src/littercoin/scripts/cardano-cli/preprod/data/mint-littercoin.costs
[
    {
        "executionUnits": {
            "memory": 1899564,
            "steps": 528441393
        },
        "lovelaceCost": 147706,
        "scriptHash": "e7a3473ad76c48a622c70c6da628b6dcb48e11a2117a3ab4c109e87a"
    },
    {
        "executionUnits": {
            "memory": 1311004,
            "steps": 395161831
        },
        "lovelaceCost": 104137,
        "scriptHash": "b40aa28af814c14d3c7513ec8e007e37fbd24d6e821677821e01492a"
    }
]


lawrence@lawrence-MacBookAir:~/src/littercoin/scripts/cardano-cli$ ls -l preprod/data/
total 112
-rw-r--r-- 1 lawrence lawrence   48 Dec  8 14:21 lc-datum-init.json
-rw-rw-r-- 1 lawrence lawrence  199 Dec  8 14:25 lc-minting-batch-file.txt
-rw-rw-r-- 1 lawrence lawrence   68 Dec  8 14:21 lc-minting-policy.hash
-rw-rw-r-- 1 lawrence lawrence 6767 Dec  8 14:21 lc-minting-policy.plutus
-rw-rw-r-- 1 lawrence lawrence  622 Dec  8 14:21 lc-token-metadata.json
-rw-r--r-- 1 lawrence lawrence   32 Dec  8 14:21 lc-token-name.json
-rw-rw-r-- 1 lawrence lawrence   62 Dec  8 14:21 lc-validator.hash
-rw-rw-r-- 1 lawrence lawrence 8125 Dec  8 14:21 lc-validator.plutus
-rw------- 1 lawrence lawrence  456 Dec  8 14:37 mint-littercoin.costs
-rw-rw-r-- 1 lawrence lawrence   68 Dec  8 14:21 nft-minting-policy.hash
-rw-rw-r-- 1 lawrence lawrence 5073 Dec  8 14:21 nft-minting-policy.plutus
-rw-rw-r-- 1 lawrence lawrence   68 Dec  8 14:21 nft-token-name.json
-rw-rw-r-- 1 lawrence lawrence   39 Dec  8 14:21 redeemer-add-ada.json
-rw-rw-r-- 1 lawrence lawrence   78 Dec  8 14:21 redeemer-burn-lc.json
-rw-rw-r-- 1 lawrence lawrence   78 Dec  8 14:21 redeemer-burn-nft.json
-rw-rw-r-- 1 lawrence lawrence   39 Dec  8 14:21 redeemer-burn.json
-rw-rw-r-- 1 lawrence lawrence   78 Dec  8 14:21 redeemer-mint-lc.json
-rw-rw-r-- 1 lawrence lawrence   78 Dec  8 14:21 redeemer-mint-nft.json
-rw-rw-r-- 1 lawrence lawrence   39 Dec  8 14:21 redeemer-mint.json
-rw-rw-r-- 1 lawrence lawrence  173 Dec  8 14:21 redeemer-thread-token-mint.json
-rw-r--r-- 1 lawrence lawrence   68 Dec  8 14:21 thread-token-minting-policy.hash
-rw-r--r-- 1 lawrence lawrence 5499 Dec  8 14:21 thread-token-minting-policy.plutus
-rw-rw-r-- 1 lawrence lawrence   76 Dec  8 14:21 thread-token-name.json
-rw-rw-r-- 1 lawrence lawrence  195 Dec  8 14:21 thread-token-value.json

